load 'deploy'
#load 'deploy/assets'
load 'config/deploy' # remove this line to skip loading any of the default tasks

task :backup_db do
  filename = "#{deploy_env}-#{Time.now.strftime('%Y-%m-%d')}.sql"
  run "pg_dump --clean cakeside_production > ~/db/backups/#{filename}"
  #run "PGPASSWORD=password pg_dump -Fc --no-acl --no-owner -h localhost -U cakeside cakeside_production > ~/db/backups/#{filename}"
  download("db/backups/#{filename}", "db/backups/", :via => :scp, :recursive => true)
end

task :restore_db do
  dumpfile = "~/db/backups/latest"
  destination_db = "cakeside_production"
  upload("latest", "db/backups/latest", :via => :scp)
  run "psql #{destination_db} < #{dumpfile}"
end
