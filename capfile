load 'deploy' if respond_to?(:namespace) # cap2 differentiator
Dir['vendor/gems/*/recipes/*.rb','vendor/plugins/*/recipes/*.rb'].each { |plugin| load(plugin) }
load 'config/deploy' # remove this line to skip loading any of the default tasks

task :search_libs, :roles => :web do
  run "ls -x1 /usr/lib | grep -i xml"
end

task :count_libs, :roles => :web do
  run "ls -x1 /usr/lib | wc -l"
end

task :show_free_space, :roles => :web do
  run "df -h /"
end

task :update_bundler do
  #run "bundle install --gemfile #{release_path}/Gemfile"
  #run "cd #{release_path} && bundle exec rake db:migrate RAILS_ENV=production && bundle exec rake db:seed RAILS_ENV=production"
end

task :backup_db do
  filename = "#{deploy_env}-#{Time.now.strftime('%Y-%m-%d')}.sql"
  run "pg_dump cakeside_production > ~/db/backups/#{filename}"
  download("db/backups/#{filename}", "db/backups/", :via => :scp, :recursive => true)
end

task :restore_db do
  upload("db/backups/#{filename}", "db/backups/#{filename}", :via => :scp)
  run "psql -U postgress -d #{destination_db} -f #{dumpfile}"
end
