<% content_for :title do %>
  Update My Account
<% end %>
<% content_for :head do %>
  <script type="text/javascript" charset="utf-8">
  $(function(){
    $('#edit_user').validate();
    $('#user_city').autocomplete({
      source: function(request, response){
        $.ajax({
          url: 'http://ws.geonames.org/searchJSON',
          dataType: "jsonp",
          data: {
            featureClass: "P",
            style: 'full',
            maxRows: 12,
            name_startsWith: request.term
          },
          success: function(data){
            response( $.map(data.geonames, function(item){
                return {
                  label: item.name + (item.adminName1 ? ", " + item.adminName1 : "") + ", " + item.countryName,
                  value: item.name + (item.adminName1 ? ", " + item.adminName1 : "") + ", " + item.countryName,
                  latitude: item.lat,
                  longitude: item.lng
                }
            }));
          }
        });
      },
      minlength:2,
      select:function(event, ui){
        var item = ui.item;
        $('#user_latitude').val(item.latitude);
        $('#user_longitude').val(item.longitude);
      }
    });
  });
  </script>
<% end %>
<ul class="nav nav-tabs">
  <li> <%= link_to "Profile", profiles_mine_path %></li>
  <li> <%= link_to "Favorites", profiles_favorites_path %></li>
  <li> <%= link_to "Add Creation", new_creation_path %></li>
  <li class="active"> <%= link_to "Settings", edit_user_registration_path %> </li>
</ul>
<div class="row">
  <div class="span9">
    <h1>Settings</h1>
    <p> If you prefer not to change your password, then just leave it blank.  </p>
    <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => { :method => :put, :class=> "form-horizontal" }) do |f| %>
      <%= devise_error_messages! %>
      <fieldset>
        <legend>Update your settings</legend>
        <div class="control-group">
          <%= f.label :name, :class => "control-label"  %>
          <div class="controls"> <%= f.text_field :name, :class => "input-xlarge" %> </div>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :email, :class => "control-label"  %>
          <div class="controls"> <%= f.email_field :email, :class => "input-xlarge"  %> </div>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :password, :class => "control-label" %> 
          <div class="controls"> <%= f.password_field :password, :class => "input-xlarge"  %> </div>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :password_confirmation, :class => "control-label" %> 
          <div class="controls"> <%= f.password_field :password_confirmation, :class => "input-xlarge" %> </div>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :current_password, :class => "control-label" %> 
          <div class="controls"> <%= f.password_field :current_password, :class => "input-xlarge" %> </div>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :city, :class => 'control-label' %>
          <div class="controls"> <%= f.text_field :city, :class => "input-xlarge" %> </div>
<%#<input type="text" data-source="[&quot;Alabama&quot;,&quot;Alaska&quot;,&quot;Arizona&quot;,&quot;Arkansas&quot;,&quot;California&quot;,&quot;Colorado&quot;,&quot;Connecticut&quot;,&quot;Delaware&quot;,&quot;Florida&quot;,&quot;Georgia&quot;,&quot;Hawaii&quot;,&quot;Idaho&quot;,&quot;Illinois&quot;,&quot;Indiana&quot;,&quot;Iowa&quot;,&quot;Kansas&quot;,&quot;Kentucky&quot;,&quot;Louisiana&quot;,&quot;Maine&quot;,&quot;Maryland&quot;,&quot;Massachusetts&quot;,&quot;Michigan&quot;,&quot;Minnesota&quot;,&quot;Mississippi&quot;,&quot;Missouri&quot;,&quot;Montana&quot;,&quot;Nebraska&quot;,&quot;Nevada&quot;,&quot;New Hampshire&quot;,&quot;New Jersey&quot;,&quot;New Mexico&quot;,&quot;New York&quot;,&quot;North Dakota&quot;,&quot;North Carolina&quot;,&quot;Ohio&quot;,&quot;Oklahoma&quot;,&quot;Oregon&quot;,&quot;Pennsylvania&quot;,&quot;Rhode Island&quot;,&quot;South Carolina&quot;,&quot;South Dakota&quot;,&quot;Tennessee&quot;,&quot;Texas&quot;,&quot;Utah&quot;,&quot;Vermont&quot;,&quot;Virginia&quot;,&quot;Washington&quot;,&quot;West Virginia&quot;,&quot;Wisconsin&quot;,&quot;Wyoming&quot;]" data-items="4" data-provide="typeahead" style="margin: 0 auto;" class="span3">%>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :website, :class => "control-label" %> 
          <div class="controls"> <%= f.url_field :website, :class => "input-xlarge, url", :placeholder => "http://cakeside.com" %> </div>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :twitter, :class => "control-label" %> 
          <div class="controls"> <%= f.text_field :twitter, :class => "input-xlarge", :placeholder => "without the @ sign", :maxlength => "255" %> </div>
        </div><!-- /control-group -->
        <div class="control-group">
          <%= f.label :facebook, :class => "control-label" %> 
          <div class="controls"> <%= f.text_field :facebook, :class => "input-xlarge", :placeholder => "http://www.facebook.com/your_profile", :maxlength => "255" %> </div>
        </div><!-- /control-group -->
        <p class="help-block">
        <strong>Note:</strong> 
        Help us better serve you by checking off what best describes you?
        </p>
        <div class="control-group">
          <label class="control-label">Interests:</label>
          <div class="controls">
            <% for interest in Interest.all %>
              <label class="checkbox">
                <%= check_box_tag "user[interest_ids][]", interest.id, current_user.interests.include?(interest) %>
                <%= interest.name %>
              </label>
            <% end %>
          </div>
        </div><!-- /control-group -->
        <div class="form-actions">
          <input type="submit" class="btn btn-primary" value="Save changes" />
          <button type="reset" class="btn">Cancel</button>
        </div>


        <%= f.hidden_field :latitude %>
        <%= f.hidden_field :longitude %>
      </fieldset>
    <% end %>
  </div>
  <div class="span3">
    <ul class="thumbnails">
      <li><a href="<%= url_for profile_path(current_user) %>"><img src="<%= avatar_url current_user %>&amp;s=200" alt="<%= current_user.name %>" /></a></li>
    </ul>
    <a href="http://en.gravatar.com/" target="_blank">Change My Photo</a>
    <p>member since: <%= current_user.created_at.to_s :foomat %></p>
    <p>last signed in: <%= current_user.last_sign_in_at.to_s :foomat %></p>

    <h4>Cancel My Account</h4>
    <p>Unhappy? <%= button_to "Cancel my account", registration_path(resource_name), :confirm => "Are you sure?", :method => :delete, :class => "btn btn-danger" %></p>
  </div>
</div>
