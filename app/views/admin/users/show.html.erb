<% content_for :javascript do %>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>
<script>
  function initialize_map() {
    var latitude = <%= @user.latitude %>;
    var longitude = <%= @user.longitude %>;
    var mapOptions = { zoom: 14, center: new google.maps.LatLng(latitude, longitude), mapTypeId: google.maps.MapTypeId.ROADMAP };
    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    var marker = new google.maps.Marker({ map: map, position: new google.maps.LatLng(latitude, longitude)});
  }
  google.maps.event.addDomListener(window, 'load', initialize_map);
</script>
<% end %>

<div class="row-fluid">
  <div class="span2">
    <%= render partial: "my/shared/my_nav" %>
  </div>
  <div class="span10">
    <h1> <%= avatar_for(@user, size: 24) %> <%= @user.name %></h1>
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>name</th>
          <th>email</th>
          <th>city</th>
          <th>website</th>
          <th>twitter</th>
          <th>facebook</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= link_to @user.name, admin_user_path(@user) %></td>
          <td><%= mail_to @user.email %></td>
          <td><%= @user.city %></td>
          <td><%= link_to @user.website %></td>
          <td><%= @user.twitter %></td>
          <td><%= link_to @user.facebook %></td>
        </tr>
      </tbody>
    </table>

    <h2>sessions</h2>
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>ip</th>
          <th>user agent</th>
          <th>accessed at</th>
          <th>revoked at</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <%- @user.user_sessions.each do |user_session| %>
          <tr>
            <td><%= link_to user_session.user.name, admin_user_path(user_session.user) %></td>
            <td><%= user_session.ip %></td>
            <td><%= user_session.user_agent %></td>
            <td><%= time_ago_in_words(user_session.accessed_at) %></td>
            <td><%= time_ago_in_words(user_session.revoked_at) if user_session.revoked_at %></td>
            <td><%= link_to "Revoke", admin_session_path(user_session), method: :delete, class: 'btn btn-danger' %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <h2>cakes</h2>
    <table class="table table-striped">
      <thead>
        <th></th>
        <th>Name</th>
        <th>Description</th>
      </thead>
      <tbody>
      <% @user.creations.each_with_index do |creation, index| %>
        <% cache creation do %>
        <tr>
          <td>
            <%= link_to creation_path(creation) do %>
              <%= image_tag creation.primary_image.url_for(:thumb), class: 'thumbnail', style: "width:65px;" %>
            <% end %>
          </td>
          <td><%= creation.name %></td>
          <td>
            <%= creation.story %>
            <%= creation.tags.map(&:name) if creation.tags.any? %>
          </td>
        </tr>
        <% end %>
      <% end %>
      </tbody>
    </table>

    <div style="overflow:hidden;height:500px;width:600px;">
      <div id="map-canvas" style="height:500px;width:600px;"></div>
      <style> img{max-width:none!important;background:none!important} </style>
    </div>
  </div>
</div>
