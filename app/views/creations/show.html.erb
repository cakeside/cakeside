<% provide(:title, "#{@creation.name} by #{@creation.user.name}") -%>
<div class="page-header">
  <h1>
    <%= @creation.name %> 
    <small>
      <% if @creation.user == current_user %>
        <%= link_to '(edit)', edit_creation_path(@creation) %> 
        <%= link_to 'Delete', creation_path(@creation),:confirm => "Are you sure", :method => :delete, :class => 'btn btn-danger' %> 
      <% end %>
      submitted by <%= link_to @creation.user.name, profile_path(@creation.user) %> 
  </small> 
</h1>
<% @creation.categories.each do |category| %>
  <span class="label"><a href="/categories/<%= category.slug %>"><%= category.name %></a></span>
<% end %> 
</div>
<div class="row">
  <div class="span12">
    <p> 
    submitted on <%= @creation.created_at.to_s :foomat %> |
    <%= link_to 'fanclub (' + pluralize(@creation.favorites.length, 'fan') + ')', creation_favorites_path(:creation_id => @creation.id)%> 
    </p>
  </div>
</div>
<div class="row">
  <div class="span6"> 
    <iframe src="http://www.facebook.com/plugins/like.php?href=<%= request.url %>" scrolling="no" frameborder="0" style="border:none; width:350px; height:30px; float:left;"></iframe>
  </div>
  <div class="span2">
    <% if user_signed_in? %>
      <% unless current_user == @creation.user || current_user.already_likes(@creation) %>
        <%= button_to "Add to favorites", creation_favorites_path(:creation_id => @creation.id), :method => :post, :class => 'btn btn-primary' %>
      <% end %>
    <% else %>
      <%= button_to "Add to favorites", creation_favorites_path(:creation_id => @creation.id), :method => :post, :class => 'btn btn-primary' %>
    <% end %>
  </div>
</div>
<div class="row">
  <div class="span12">
    <ul class="thumbnails">
      <li class="span8">
      <a class="thumbnail" href="<%= url_for creation_path(@creation) %>"><img src="<%= @creation.image_url(:large).to_s %>" alt="<%= @creation.name %>" /></a>
      </li>
      <% @creation.photos.each do |photo| %>
        <li class="span4">
        <a class="thumbnail" href="#"><img alt="<%= @creation.name %>" src="<%= photo.image.thumb.url.to_s%>"></a>
        </li>
      <% end %>
      <% if @creation.user == current_user %>
        <% if @creation.photos.length < 3 %>
          <h3>Add another photo</h3>
          <% unless @creation.new_record? %>
            <%= form_tag(creation_photos_path(@creation), :method => "post", :multipart => true) do |f| %>
              <%= fields_for Photo.new do |f| %>
                <%= f.file_field :image, :rel => creation_photos_path(@creation) %>
                <input type="submit" class="btn primary" value="Add photo" />
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end -%>
    </ul>
  </div>
</div>
<div class="row">
  <div class="span12">
    <h3>Description</h3>
    <p><%= @creation.story %></p>
  </div>
</div>
<div class="row">
  <div class="span12">
    <h3>Comments <small><%= pluralize @creation.comment_threads.length, "comment" %></small></h3>
    <% unless user_signed_in? %>
      <p><%= link_to "sign in", new_user_session_path %>  to comment </p>
    <% end -%>
    <table class="table table-striped">
      <% @creation.comment_threads.each do |comment| %>
        <tr>
          <td><%= gravatar_for comment.user %></td>
          <td><%= comment.body %></td>
          <td><%= comment.created_at.to_s :foomat %></td>
        </tr>
      <% end -%>
    </table>
    <%= form_tag(creation_comments_path(@creation), :method => "post", :html => { :class => "form-horizontal"}) do |f| %>
      <%= fields_for Comment.new do |f| %>
        <label>Add a comment</label>
        <%= f.text_area :body, :class => "span12" %>
        <input type="submit" class="btn" value="Add Comment" />
      <% end %>
    <% end %>
  </div>
</div>
