<% content_for :head do %>
  <style type="text/css">
.preview {
  width:210px;
  height:150px;
  overflow:hidden;
}
  </style>
<script type="text/javascript" charset="utf-8">
$(function() {
    try{
  $('#cropbox').Jcrop({
    onChange: update_crop,
    onSelect: update_crop,
    setSelect: [100, 100, 210, 150],
    aspectRatio: 1.4
  });
  }catch(e){
  alert(e);
  }
});

function update_crop(coords) {
    var rx = 210/coords.w;
    var ry = 150/coords.h;
    var lw = $('#cropbox').width();
    var lh = $('#cropbox').height();

  $('#preview').css({
    width: Math.round(rx * lw) + 'px',
    height: Math.round(ry * lh) + 'px',
    marginLeft: '-' + Math.round(rx * coords.x) + 'px',
    marginTop: '-' + Math.round(ry * coords.y) + 'px'
  });

  $("#crop_x").val(coords.x);
  $("#crop_y").val(coords.y);
  $("#crop_w").val(coords.w);
  $("#crop_h").val(coords.h);
}
</script>
<% end %>

<div class="row">
  <div class="page-header">
    <h1> <%= @creation.name %> <small> submitted by <%= link_to @creation.user.name, profile_path(@creation.user) %> </small> </h1>
    <% @creation.categories.each do |category| %>
      <span class="label notice"><a href="/categories/<%= category.slug %>"><%= category.name %></a></span>
    <% end %> 
  </div>
</div>
<div class="row">
    <div class="span12">
      <%= image_tag @creation.image_url, :id => "cropbox" %>
    </div>
    <div class="span4">
      <h3>Crop Preview</h3>
      <div class="preview">
          <%= image_tag @creation.image_url, :id => "preview" %>
      </div>
    </div>
</div>
<div class="row">
  <div class="span16">
    <h2>Next</h2>
    <%= form_for @creation, :url => creations_crop_update_path(@creation) do |f| %>
        <% for attribute in [:crop_x, :crop_y, :crop_h, :crop_w] %>
            <%= f.hidden_field attribute, :id => attribute %>
        <% end %>
        <div class="well">
          <%= f.submit "Publish", :class => "btn large primary" %>
          <%# <a class="btn large primary" href="#">Publish</a>%>
          <a class="btn large" href="<%= url_for creation_path(@creation) %>">Skip</a>
        </div>
    <% end %>
  </div>
</div>


