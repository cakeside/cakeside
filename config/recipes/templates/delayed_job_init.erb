#! /bin/sh
### BEGIN INIT INFO
# Provides:          delayed_job
# Required-Start:    $all
# Required-Stop:
# Default-Start:     2 3 4 5
# Default-Stop:
### END INIT INFO
set -e

N=/etc/init.d/delayed_job_<%= application %>
app_root=<%= current_path %>
user=<%= user %>
service="delayed_job"

usage() {
  echo "Usage: $N {start|stop|status|restart|force-reload} <environment>" >&2
  exit 1
}

set -e

#[ -n "$2" ] || usage

#rails_env="$2"
rails_env=PRODUCTION

interact() {
    op="$1"
    echo "$1ing $service"
    su - -c "cd $app_root; RAILS_ENV=<%= rails_env %> bundle exec script/delayed_job $op" $user
}

case "$1" in
    start|stop|status)
        interact "$1"
        ;;
    reload|restart|force-reload)
        interact restart
        ;;
    *)
        usage
        ;;
esac

exit 0
